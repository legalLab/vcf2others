<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="vcf2others">
<title>vcf2others • vcf2others</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="vcf2others">
<meta property="og:description" content="vcf2others">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">vcf2others</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.9.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item">
  <a class="nav-link" href="../articles/vcf2others.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>vcf2others</h1>
                        <h4 data-toc-skip class="author">Tomas
Hrbek</h4>
            
            <h4 data-toc-skip class="date">11/26/2023</h4>
      
      
      <div class="d-none name"><code>vcf2others.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">vcf2others</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This package has two main functionalities. First, it is used for
filtering, subsetting, merging and otherwise wrangling VCF files.
Second, it is used for converting the VCF file to other population
genetic and phylogenetic formats for downstream analyses.</p>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>This package needs to be installed from GitHub.
<code>devtools::install_github("legalLab/vcf2others")</code></p>
</div>
<div class="section level2">
<h2 id="how-to-use-the-functions-of-this-package">How to use the functions of this package<a class="anchor" aria-label="anchor" href="#how-to-use-the-functions-of-this-package"></a>
</h2>
<p>Following are examples of the usage of the functions of this
package.</p>
<div class="section level3">
<h3 id="load-vcf-and-associated-files-of-individuals-and-groups">Load VCF and associated files of individuals and groups<a class="anchor" aria-label="anchor" href="#load-vcf-and-associated-files-of-individuals-and-groups"></a>
</h3>
<p>First we need to load our files. In addition to the VCF, we also need
to have a white/black list of individuals (read from a file of one
column with an ‘id’ header), a strata file associating individuals with
groups (read from a file of two tab-separated columns with an ‘id’ and
‘pop’ headers), and a file of groups (read from a file of one column
with a ‘pop’ header). These auxilary files are used for
keeping/excluding individuals and groups of individuals during filtering
and during conversion to other data formats. The strata file is also
necessary since many of the population genetic formats require
information on grouping of individuals.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="fu">library</span>(vcfR)</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="co">#&gt;    *****       ***   vcfR   ***       *****</span></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="co">#&gt;    This is vcfR 1.14.0 </span></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a><span class="co">#&gt;      browseVignettes('vcfR') # Documentation</span></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a><span class="co">#&gt;      citation('vcfR') # Citation</span></span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a><span class="co">#&gt;    *****       *****      *****       *****</span></span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a><span class="co">#&gt;     filter, lag</span></span>
<span id="cb2-14"><a href="#cb2-14" tabindex="-1"></a><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span id="cb2-15"><a href="#cb2-15" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb2-16"><a href="#cb2-16" tabindex="-1"></a><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span id="cb2-17"><a href="#cb2-17" tabindex="-1"></a><span class="fu">library</span>(vcf2others)</span>
<span id="cb2-18"><a href="#cb2-18" tabindex="-1"></a></span>
<span id="cb2-19"><a href="#cb2-19" tabindex="-1"></a><span class="co"># path to example files</span></span>
<span id="cb2-20"><a href="#cb2-20" tabindex="-1"></a>fpath <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="fu">system.file</span>(<span class="st">"extdata"</span>, <span class="at">package=</span><span class="st">"vcf2others"</span>), <span class="st">"/"</span>)</span>
<span id="cb2-21"><a href="#cb2-21" tabindex="-1"></a><span class="co"># set path and project name</span></span>
<span id="cb2-22"><a href="#cb2-22" tabindex="-1"></a>path <span class="ot">&lt;-</span> <span class="st">"/home/tomas/git/legal_public/packages/data/"</span></span>
<span id="cb2-23"><a href="#cb2-23" tabindex="-1"></a>project <span class="ot">&lt;-</span> <span class="st">"trigonatus_all_sub"</span></span>
<span id="cb2-24"><a href="#cb2-24" tabindex="-1"></a></span>
<span id="cb2-25"><a href="#cb2-25" tabindex="-1"></a><span class="co"># load vcf</span></span>
<span id="cb2-26"><a href="#cb2-26" tabindex="-1"></a>vcf <span class="ot">&lt;-</span> <span class="fu">read.vcfR</span>(<span class="fu">paste0</span>(fpath, project, <span class="st">".vcf.gz"</span>))</span>
<span id="cb2-27"><a href="#cb2-27" tabindex="-1"></a><span class="co">#&gt; Scanning file to determine attributes.</span></span>
<span id="cb2-28"><a href="#cb2-28" tabindex="-1"></a><span class="co">#&gt; File attributes:</span></span>
<span id="cb2-29"><a href="#cb2-29" tabindex="-1"></a><span class="co">#&gt;   meta lines: 22</span></span>
<span id="cb2-30"><a href="#cb2-30" tabindex="-1"></a><span class="co">#&gt;   header_line: 23</span></span>
<span id="cb2-31"><a href="#cb2-31" tabindex="-1"></a><span class="co">#&gt;   variant count: 10000</span></span>
<span id="cb2-32"><a href="#cb2-32" tabindex="-1"></a><span class="co">#&gt;   column count: 21</span></span>
<span id="cb2-33"><a href="#cb2-33" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb2-34"><a href="#cb2-34" tabindex="-1"></a>Meta line <span class="dv">22</span> read in.</span>
<span id="cb2-35"><a href="#cb2-35" tabindex="-1"></a><span class="co">#&gt; All meta lines processed.</span></span>
<span id="cb2-36"><a href="#cb2-36" tabindex="-1"></a><span class="co">#&gt; gt matrix initialized.</span></span>
<span id="cb2-37"><a href="#cb2-37" tabindex="-1"></a><span class="co">#&gt; Character matrix gt created.</span></span>
<span id="cb2-38"><a href="#cb2-38" tabindex="-1"></a><span class="co">#&gt;   Character matrix gt rows: 10000</span></span>
<span id="cb2-39"><a href="#cb2-39" tabindex="-1"></a><span class="co">#&gt;   Character matrix gt cols: 21</span></span>
<span id="cb2-40"><a href="#cb2-40" tabindex="-1"></a><span class="co">#&gt;   skip: 0</span></span>
<span id="cb2-41"><a href="#cb2-41" tabindex="-1"></a><span class="co">#&gt;   nrows: 10000</span></span>
<span id="cb2-42"><a href="#cb2-42" tabindex="-1"></a><span class="co">#&gt;   row_num: 0</span></span>
<span id="cb2-43"><a href="#cb2-43" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb2-44"><a href="#cb2-44" tabindex="-1"></a>Processed variant <span class="dv">1000</span></span>
<span id="cb2-45"><a href="#cb2-45" tabindex="-1"></a>Processed variant <span class="dv">2000</span></span>
<span id="cb2-46"><a href="#cb2-46" tabindex="-1"></a>Processed variant <span class="dv">3000</span></span>
<span id="cb2-47"><a href="#cb2-47" tabindex="-1"></a>Processed variant <span class="dv">4000</span></span>
<span id="cb2-48"><a href="#cb2-48" tabindex="-1"></a>Processed variant <span class="dv">5000</span></span>
<span id="cb2-49"><a href="#cb2-49" tabindex="-1"></a>Processed variant <span class="dv">6000</span></span>
<span id="cb2-50"><a href="#cb2-50" tabindex="-1"></a>Processed variant <span class="dv">7000</span></span>
<span id="cb2-51"><a href="#cb2-51" tabindex="-1"></a>Processed variant <span class="dv">8000</span></span>
<span id="cb2-52"><a href="#cb2-52" tabindex="-1"></a>Processed variant <span class="dv">9000</span></span>
<span id="cb2-53"><a href="#cb2-53" tabindex="-1"></a>Processed variant <span class="dv">10000</span></span>
<span id="cb2-54"><a href="#cb2-54" tabindex="-1"></a>Processed variant<span class="sc">:</span> <span class="dv">10000</span></span>
<span id="cb2-55"><a href="#cb2-55" tabindex="-1"></a><span class="co">#&gt; All variants processed</span></span>
<span id="cb2-56"><a href="#cb2-56" tabindex="-1"></a></span>
<span id="cb2-57"><a href="#cb2-57" tabindex="-1"></a><span class="co"># read individuals to include</span></span>
<span id="cb2-58"><a href="#cb2-58" tabindex="-1"></a>indivs <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="fu">paste0</span>(fpath, <span class="st">"indivs_b"</span>), <span class="at">header =</span> <span class="cn">TRUE</span>)<span class="sc">$</span>id <span class="sc">%&gt;%</span></span>
<span id="cb2-59"><a href="#cb2-59" tabindex="-1"></a>  <span class="fu">as.character</span>()</span>
<span id="cb2-60"><a href="#cb2-60" tabindex="-1"></a></span>
<span id="cb2-61"><a href="#cb2-61" tabindex="-1"></a><span class="co"># check if all indivs are in vcf_names</span></span>
<span id="cb2-62"><a href="#cb2-62" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">any</span>(<span class="sc">!</span>(indivs <span class="sc">%in%</span> <span class="fu">colnames</span>(vcf<span class="sc">@</span>gt)[<span class="sc">-</span><span class="dv">1</span>]))) <span class="fu">stop</span>(<span class="fu">paste</span>(<span class="st">"Some individuals in list not in VCF"</span>))</span>
<span id="cb2-63"><a href="#cb2-63" tabindex="-1"></a></span>
<span id="cb2-64"><a href="#cb2-64" tabindex="-1"></a><span class="co"># read all sample names in vcf</span></span>
<span id="cb2-65"><a href="#cb2-65" tabindex="-1"></a>vcf_names <span class="ot">&lt;-</span> <span class="fu">colnames</span>(vcf<span class="sc">@</span>gt)[<span class="sc">-</span><span class="dv">1</span>] <span class="sc">%&gt;%</span></span>
<span id="cb2-66"><a href="#cb2-66" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb2-67"><a href="#cb2-67" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">id =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-68"><a href="#cb2-68" tabindex="-1"></a>  <span class="fu">mutate</span>(id, <span class="at">id =</span> <span class="fu">as.character</span>(id))</span>
<span id="cb2-69"><a href="#cb2-69" tabindex="-1"></a></span>
<span id="cb2-70"><a href="#cb2-70" tabindex="-1"></a><span class="co"># read sample to group assignment</span></span>
<span id="cb2-71"><a href="#cb2-71" tabindex="-1"></a>strata <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="fu">paste0</span>(fpath, <span class="st">"strata"</span>), <span class="at">header =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-72"><a href="#cb2-72" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb2-73"><a href="#cb2-73" tabindex="-1"></a>  <span class="fu">mutate</span>(id, <span class="at">id =</span> <span class="fu">as.character</span>(id))</span>
<span id="cb2-74"><a href="#cb2-74" tabindex="-1"></a></span>
<span id="cb2-75"><a href="#cb2-75" tabindex="-1"></a><span class="co"># assign samples in vcf to groups</span></span>
<span id="cb2-76"><a href="#cb2-76" tabindex="-1"></a>strata <span class="ot">&lt;-</span> vcf_names <span class="sc">%&gt;%</span></span>
<span id="cb2-77"><a href="#cb2-77" tabindex="-1"></a>  <span class="fu">left_join</span>(strata)</span>
<span id="cb2-78"><a href="#cb2-78" tabindex="-1"></a><span class="co">#&gt;  [1m [22mJoining with `by = join_by(id)`</span></span>
<span id="cb2-79"><a href="#cb2-79" tabindex="-1"></a></span>
<span id="cb2-80"><a href="#cb2-80" tabindex="-1"></a><span class="co"># check if all samples in vcf are assigned to groups</span></span>
<span id="cb2-81"><a href="#cb2-81" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">any</span>(<span class="fu">is.na</span>(strata<span class="sc">$</span>pop) <span class="sc">==</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb2-82"><a href="#cb2-82" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">"vcf has individuals not assigned to a group"</span>)</span>
<span id="cb2-83"><a href="#cb2-83" tabindex="-1"></a>  <span class="fu">print</span>(strata[<span class="fu">is.na</span>(strata<span class="sc">$</span>pop) <span class="sc">==</span> <span class="cn">TRUE</span>,])</span>
<span id="cb2-84"><a href="#cb2-84" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb2-85"><a href="#cb2-85" tabindex="-1"></a>  indiv_group <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(strata<span class="sc">$</span>pop)</span>
<span id="cb2-86"><a href="#cb2-86" tabindex="-1"></a>}</span>
<span id="cb2-87"><a href="#cb2-87" tabindex="-1"></a></span>
<span id="cb2-88"><a href="#cb2-88" tabindex="-1"></a><span class="co"># read groups to be used; filter only those that are actually present</span></span>
<span id="cb2-89"><a href="#cb2-89" tabindex="-1"></a>groups <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="fu">paste0</span>(fpath, <span class="st">"groups"</span>), <span class="at">header =</span> <span class="cn">TRUE</span>)[,<span class="dv">1</span>] <span class="sc">%&gt;%</span></span>
<span id="cb2-90"><a href="#cb2-90" tabindex="-1"></a>  .[. <span class="sc">%in%</span> <span class="fu">unique</span>(strata<span class="sc">$</span>pop)] <span class="sc">%&gt;%</span></span>
<span id="cb2-91"><a href="#cb2-91" tabindex="-1"></a>  <span class="fu">as.factor</span>()</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="filtering-subsetting-merging-and-otherwise-wrangling-vcf-files">Filtering, subsetting, merging and otherwise wrangling VCF
files<a class="anchor" aria-label="anchor" href="#filtering-subsetting-merging-and-otherwise-wrangling-vcf-files"></a>
</h3>
<p>All functions can be used directly on a VCF, but many of them are
called by the other functions of this package. For example
<code><a href="../reference/vcf_filter_invariant.html">vcf_filter_invariant()</a></code> will remove invariant SNPs from a
VCF, however, VCF by definition should not have invariant SNPs. However,
if a VCF is subsetted or certain individuals are removed, SNPs can
become invariant and need to be removed.</p>
<div class="section level4">
<h4 id="subsetting">Subsetting<a class="anchor" aria-label="anchor" href="#subsetting"></a>
</h4>
<p>The functions <code><a href="../reference/vcf_extract_indivs.html">vcf_extract_indivs()</a></code>,
<code><a href="../reference/vcf_extract_pops.html">vcf_extract_pops()</a></code> and <code><a href="../reference/vcf_sub_loci.html">vcf_sub_loci()</a></code> are used
to subset a VCF by specific individuals, a group (all individuals of a
group/population), or a random subset of loci, respectively. Subsetting
individuals and groups can be done either as a whitelist (keep the
listed individuals/groups) or blacklist (remove the listed
individuals/groups).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># subset VCF by individuals (default whitelist = TRUE, remove invariants = TRUE)</span></span>
<span><span class="va">indivs1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CTGA_H4683"</span>, <span class="st">"CTGA_H4689"</span><span class="op">)</span></span>
<span><span class="va">vcf1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vcf_extract_indivs.html">vcf_extract_indivs</a></span><span class="op">(</span><span class="va">vcf</span>, <span class="va">indivs1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># subset VCF by groups (default whitelist = TRUE, remove invariants = TRUE)</span></span>
<span><span class="va">groups1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bob"</span>, <span class="st">"joe"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">vcf1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vcf_extract_pops.html">vcf_extract_pops</a></span><span class="op">(</span><span class="va">vcf</span>, <span class="va">indiv_group</span>, <span class="va">groups1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># subset VCF by n random loci (default n_loci = 1000)</span></span>
<span><span class="va">vcf1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vcf_sub_loci.html">vcf_sub_loci</a></span><span class="op">(</span><span class="va">vcf</span>, n_loci <span class="op">=</span> <span class="fl">5000</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="filtering">Filtering<a class="anchor" aria-label="anchor" href="#filtering"></a>
</h4>
<p>Filtering consists of removing individuals and loci based on specific
properties. The function <code><a href="../reference/vcf_filter_missing_indivs.html">vcf_filter_missing_indivs()</a></code>
removes individuals above a % missing SNP threshold. The other functions
filter on properties of individuals SNPs across individuals. The
function <code><a href="../reference/vcf_filter_missingness.html">vcf_filter_missingness()</a></code> removes SNPs above a %
missing threshold, <code><a href="../reference/vcf_filter_quality.html">vcf_filter_quality()</a></code> removes SNPs below
a quality threshold, <code><a href="../reference/vcf_filter_maf.html">vcf_filter_maf()</a></code> removes SNPs with
minor allele frequency below a % threshold,
<code><a href="../reference/vcf_filter_hets.html">vcf_filter_hets()</a></code> removes SNPs with heterozigosity above a
% threshold, <code><a href="../reference/vcf_filter_rank.html">vcf_filter_rank()</a></code> removes SNPs with rank below
a % threshold (rank is specific to VCFs generated by DiscoSnpRad and
measures the likelihood of observed SNP variation being due to
paralogs), and <code><a href="../reference/vcf_filter_coverage.html">vcf_filter_coverage()</a></code> removes SNPs below a
specific coverage (makes them missing in the individual). Finally the
<code><a href="../reference/vcf_filter_invariant.html">vcf_filter_invariant()</a></code> removes invariant SNPs (SNPs may
become invariant after subsetting and filtering). The functions
<code><a href="../reference/vcf_filter_oneSNP.html">vcf_filter_oneSNP()</a></code> and <code><a href="../reference/vcf_filter_multiSNP.html">vcf_filter_multiSNP()</a></code>
filter a VCF to remove linked SNPs (retain only unliked SNPs) or retain
only linked SNPs, respectively. In general, all analyses assume that
SNPs are unlinked, however, some analyses such as FineRadStructure work
with linked SNPs.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># filter VCF for analyses (unlinked SNPs)</span></span>
<span><span class="va">vcf_oneSNP</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vcf_extract_indivs.html">vcf_extract_indivs</a></span><span class="op">(</span><span class="va">vcf</span>, <span class="va">indivs</span>, whitelist <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="../reference/vcf_filter_missing_indivs.html">vcf_filter_missing_indivs</a></span><span class="op">(</span><span class="fl">.9</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="../reference/vcf_filter_rank.html">vcf_filter_rank</a></span><span class="op">(</span><span class="fl">.5</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="../reference/vcf_filter_maf.html">vcf_filter_maf</a></span><span class="op">(</span><span class="fl">.03</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="../reference/vcf_filter_coverage.html">vcf_filter_coverage</a></span><span class="op">(</span><span class="fl">6</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="../reference/vcf_filter_oneSNP.html">vcf_filter_oneSNP</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="../reference/vcf_filter_missingness.html">vcf_filter_missingness</a></span><span class="op">(</span><span class="fl">.4</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="../reference/vcf_filter_missing_indivs.html">vcf_filter_missing_indivs</a></span><span class="op">(</span><span class="fl">.2</span><span class="op">)</span></span>
<span><span class="co">#&gt; removed samples are: CTGA_H3327 </span></span>
<span><span class="co">#&gt;  removed samples are: CTGA_H3600 </span></span>
<span><span class="co">#&gt; [1] "final % missing data in VCF is 57.17 %"</span></span>
<span><span class="co">#&gt; [1] "final % missing data in VCF is 25.42 %"</span></span>
<span><span class="co">#&gt; removed samples are: CTGA_H3646 </span></span>
<span><span class="co">#&gt;  removed samples are: CTGA_H4598 </span></span>
<span><span class="co">#&gt;  removed samples are: CTGA_H4613 </span></span>
<span><span class="co">#&gt;  removed samples are: CTGA_H4683 </span></span>
<span><span class="co">#&gt;  removed samples are: CTGA_H4689 </span></span>
<span><span class="co">#&gt; [1] "final % missing data in VCF is 2.92 %"</span></span>
<span></span>
<span><span class="co"># filter VCF for analyses (linked SNPs)</span></span>
<span><span class="va">vcf_multiSNP</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vcf_extract_indivs.html">vcf_extract_indivs</a></span><span class="op">(</span><span class="va">vcf</span>, <span class="va">indivs</span>, whitelist <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="../reference/vcf_filter_missing_indivs.html">vcf_filter_missing_indivs</a></span><span class="op">(</span><span class="fl">.9</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="../reference/vcf_filter_rank.html">vcf_filter_rank</a></span><span class="op">(</span><span class="fl">.5</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="../reference/vcf_filter_maf.html">vcf_filter_maf</a></span><span class="op">(</span><span class="fl">.03</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="../reference/vcf_filter_coverage.html">vcf_filter_coverage</a></span><span class="op">(</span><span class="fl">6</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="../reference/vcf_filter_multiSNP.html">vcf_filter_multiSNP</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="../reference/vcf_filter_missingness.html">vcf_filter_missingness</a></span><span class="op">(</span><span class="fl">.4</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="../reference/vcf_filter_missing_indivs.html">vcf_filter_missing_indivs</a></span><span class="op">(</span><span class="fl">.2</span><span class="op">)</span></span>
<span><span class="co">#&gt; removed samples are: CTGA_H3327 </span></span>
<span><span class="co">#&gt;  removed samples are: CTGA_H3600 </span></span>
<span><span class="co">#&gt; [1] "final % missing data in VCF is 57.17 %"</span></span>
<span><span class="co">#&gt; [1] "final % missing data in VCF is 25.2 %"</span></span>
<span><span class="co">#&gt; removed samples are: CTGA_H3646 </span></span>
<span><span class="co">#&gt;  removed samples are: CTGA_H4613 </span></span>
<span><span class="co">#&gt;  removed samples are: CTGA_H4683 </span></span>
<span><span class="co">#&gt;  removed samples are: CTGA_H4689 </span></span>
<span><span class="co">#&gt; [1] "final % missing data in VCF is 5.15 %"</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="extracting-merging-and-adding">Extracting, merging and adding<a class="anchor" aria-label="anchor" href="#extracting-merging-and-adding"></a>
</h4>
<p>The functions <code><a href="../reference/vcf_merge.html">vcf_merge()</a></code>,
<code><a href="../reference/vcf_add_indivs.html">vcf_add_indivs()</a></code>, <code><a href="../reference/vcf_extract_indivs.html">vcf_extract_indivs()</a></code> and
<code><a href="../reference/vcf_extract_pops.html">vcf_extract_pops()</a></code> are used to merge two VCF files, add
individuals from a second VCF into a first VCF, and extract
individuals/groups from a VCF saving it into a separate VCF. The
<code><a href="../reference/vcf_add_indivs.html">vcf_add_indivs()</a></code>, <code><a href="../reference/vcf_extract_indivs.html">vcf_extract_indivs()</a></code> and
<code><a href="../reference/vcf_extract_pops.html">vcf_extract_pops()</a></code> functions were designed in mind to work
with outgroups. Because of phylogenetic effects, outgroups have
relatively more missing data than ingroups, and so often are removed
during filtering. The solution is to extract the outgroup taxa with
<code><a href="../reference/vcf_extract_indivs.html">vcf_extract_indivs()</a></code> or <code><a href="../reference/vcf_extract_pops.html">vcf_extract_pops()</a></code>,
filter the ingroup VCF, and add the outgroup taxa with
<code><a href="../reference/vcf_add_indivs.html">vcf_add_indivs()</a></code>. It is important to NOT filter invariant
loci during the filtering of the ingroup, and only filter them
<code><a href="../reference/vcf_filter_invariant.html">vcf_filter_invariant()</a></code> after adding back the outgroup. The
functions <code><a href="../reference/vcf_extract_indivs.html">vcf_extract_indivs()</a></code>,
<code><a href="../reference/vcf_extract_pops.html">vcf_extract_pops()</a></code>,
<code><a href="../reference/vcf_filter_missing_indivs.html">vcf_filter_missing_indivs()</a></code> and
<code><a href="../reference/vcf_filter_coverage.html">vcf_filter_coverage()</a></code> by default filter invariants, but
this can be turned off using the “f_invar = FALSE” flag.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># extract individuals from VCF (keep all loci)</span></span>
<span><span class="va">indivs1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CTGA_H4644"</span>, <span class="st">"CTGA_H4661"</span>, <span class="st">"CTGA_H4683"</span>, <span class="st">"CTGA_H4689"</span><span class="op">)</span></span>
<span><span class="va">vcf_outgrp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vcf_extract_indivs.html">vcf_extract_indivs</a></span><span class="op">(</span><span class="va">vcf</span>, <span class="va">indivs1</span>, f_invar <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">vcf_ingrp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vcf_extract_indivs.html">vcf_extract_indivs</a></span><span class="op">(</span><span class="va">vcf</span>, <span class="va">indivs1</span>, whitelist <span class="op">=</span> <span class="cn">FALSE</span>, f_invar <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># extract groups of individuals from VCF (keep all loci)</span></span>
<span><span class="va">groups1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="st">"outgrp"</span><span class="op">)</span></span>
<span><span class="va">vcf_outgrp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vcf_extract_pops.html">vcf_extract_pops</a></span><span class="op">(</span><span class="va">vcf</span>, <span class="va">indiv_group</span>, <span class="va">groups1</span>, f_invar <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">vcf_ingrp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vcf_extract_pops.html">vcf_extract_pops</a></span><span class="op">(</span><span class="va">vcf</span>, <span class="va">indiv_group</span>, <span class="va">groups1</span>, whitelist <span class="op">=</span> <span class="cn">FALSE</span>, f_invar <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># merge vcf_outgrp into vcf_ingrp</span></span>
<span><span class="va">vcf1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vcf_merge.html">vcf_merge</a></span><span class="op">(</span><span class="va">vcf_ingrp</span>, <span class="va">vcf_outgrp</span><span class="op">)</span></span>
<span><span class="co">#&gt; Joining with `by = join_by(FORMAT, id)`</span></span>
<span></span>
<span><span class="co"># add individuals from vcf_outgrp into vcf_ingrp (whitelist = TRUE is default)</span></span>
<span><span class="va">indivs1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CTGA_H4683"</span>, <span class="st">"CTGA_H4689"</span><span class="op">)</span></span>
<span><span class="va">vcf1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vcf_add_indivs.html">vcf_add_indivs</a></span><span class="op">(</span><span class="va">vcf_ingrp</span>, <span class="va">vcf_outgrp</span>, <span class="va">indivs1</span><span class="op">)</span></span>
<span><span class="co">#&gt; Joining with `by = join_by(FORMAT, id)`</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="filtering-with-outgroup">Filtering with outgroup<a class="anchor" aria-label="anchor" href="#filtering-with-outgroup"></a>
</h4>
<p>Outgroups, which tend to have many fewer individuals than ingroups,
has more missing data than ingroups due to phylogenetic effects.
Filtering the entire dataset often results in removal of the outgroup
taxa when <code><a href="../reference/vcf_filter_invariant.html">vcf_filter_invariant()</a></code> is used during filtering
to remove individuals with % missing data above some threshold.
Therefore, a better strategy may be to extract the outgroup, filter the
ingroup, add the outgroup, and remove any invariant SNPs.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># extract outgroup from VCF (keep all loci)</span></span>
<span><span class="va">groups1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="st">"outgrp"</span><span class="op">)</span></span>
<span><span class="va">vcf_outgrp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vcf_extract_pops.html">vcf_extract_pops</a></span><span class="op">(</span><span class="va">vcf</span>, <span class="va">indiv_group</span>, <span class="va">groups1</span>, f_invar <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># filter ingroup VCF for analyses then add outgroups</span></span>
<span><span class="va">vcf1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vcf_extract_pops.html">vcf_extract_pops</a></span><span class="op">(</span><span class="va">vcf</span>, <span class="va">indiv_group</span>, <span class="va">groups1</span>, whitelist <span class="op">=</span> <span class="cn">FALSE</span>, f_invar <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="../reference/vcf_filter_missing_indivs.html">vcf_filter_missing_indivs</a></span><span class="op">(</span><span class="fl">.9</span>, f_invar <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="../reference/vcf_filter_rank.html">vcf_filter_rank</a></span><span class="op">(</span><span class="fl">.5</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="../reference/vcf_filter_maf.html">vcf_filter_maf</a></span><span class="op">(</span><span class="fl">.03</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="../reference/vcf_filter_coverage.html">vcf_filter_coverage</a></span><span class="op">(</span><span class="fl">6</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="../reference/vcf_filter_oneSNP.html">vcf_filter_oneSNP</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="../reference/vcf_filter_missingness.html">vcf_filter_missingness</a></span><span class="op">(</span><span class="fl">.4</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="../reference/vcf_filter_missing_indivs.html">vcf_filter_missing_indivs</a></span><span class="op">(</span><span class="fl">.2</span>, f_invar <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="../reference/vcf_merge.html">vcf_merge</a></span><span class="op">(</span><span class="va">vcf_outgrp</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="../reference/vcf_filter_invariant.html">vcf_filter_invariant</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; removed samples are: CTGA_H3327 </span></span>
<span><span class="co">#&gt;  removed samples are: CTGA_H3600 </span></span>
<span><span class="co">#&gt; [1] "final % missing data in VCF is 41.24 %"</span></span>
<span><span class="co">#&gt; [1] "final % missing data in VCF is 11.45 %"</span></span>
<span><span class="co">#&gt; removed samples are: CTGA_H3646 </span></span>
<span><span class="co">#&gt; [1] "final % missing data in VCF is 6.32 %"</span></span>
<span><span class="co">#&gt; Joining with `by = join_by(FORMAT, id)`</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="converting-a-vcf-file-to-other-population-genetic-and-phylogenetic-formats">Converting a VCF file to other population genetic and phylogenetic
formats<a class="anchor" aria-label="anchor" href="#converting-a-vcf-file-to-other-population-genetic-and-phylogenetic-formats"></a>
</h3>
<p>All the following functions will take a VCF, groups and indiv_group
(individuals to groups relationship), and convert the VCF to other
populations genetic and phylogenetic formats, exporting/writing a file
of this format. By default all functions will include missing data. If
that is not desired, only 100% complete data matrices can be exported
using the “inc_missing = FALSE” flag. The function
<code><a href="../reference/vcf2genlight.html">vcf2genlight()</a></code> automatically returns a genlight object and
optionally can also export/write a file of this format to the working
directory. Generally the <code><a href="../reference/vcf2genlight.html">vcf2genlight()</a></code> function is called
within a script using functions of the <code>adegenet</code> package
rather than importing the genlight object.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">project</span> <span class="op">&lt;-</span> <span class="st">"trigonatus"</span></span>
<span></span>
<span><span class="co">##########</span></span>
<span><span class="co"># datasets for analyses with unlinked SNPs</span></span>
<span><span class="va">vcf</span> <span class="op">&lt;-</span> <span class="va">vcf_oneSNP</span></span>
<span></span>
<span><span class="co"># read all sample names in vcf</span></span>
<span><span class="va">vcf_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">vcf</span><span class="op">@</span><span class="va">gt</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">as_tibble</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">rename</span><span class="op">(</span>id <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span><span class="va">id</span>, id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># read sample to group assignment</span></span>
<span><span class="va">strata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">fpath</span>, <span class="st">"strata"</span><span class="op">)</span>, header <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">as_tibble</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span><span class="va">id</span>, id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># assign samples in vcf to groups</span></span>
<span><span class="va">strata</span> <span class="op">&lt;-</span> <span class="va">vcf_names</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">left_join</span><span class="op">(</span><span class="va">strata</span><span class="op">)</span></span>
<span><span class="co">#&gt; Joining with `by = join_by(id)`</span></span>
<span></span>
<span><span class="co"># check if all samples in vcf are assigned to groups</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">strata</span><span class="op">$</span><span class="va">pop</span><span class="op">)</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"vcf has individuals not assigned to a group"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">strata</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">strata</span><span class="op">$</span><span class="va">pop</span><span class="op">)</span> <span class="op">==</span> <span class="cn">TRUE</span>,<span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="va">indiv_group</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">strata</span><span class="op">$</span><span class="va">pop</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># read groups to be used; filter only those that are actually present</span></span>
<span><span class="va">groups</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">fpath</span>, <span class="st">"groups"</span><span class="op">)</span>, header <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">%&gt;%</span></span>
<span>  <span class="va">.</span><span class="op">[</span><span class="va">.</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">strata</span><span class="op">$</span><span class="va">pop</span><span class="op">)</span><span class="op">]</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co">##########</span></span>
<span><span class="co"># export data formats</span></span>
<span><span class="co"># migrate-n https://peterbeerli.com/migrate-html5/</span></span>
<span><span class="fu"><a href="../reference/vcf2migrate.html">vcf2migrate</a></span><span class="op">(</span><span class="va">vcf</span>, <span class="va">indiv_group</span>, <span class="va">groups</span>, out_file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">path</span>, <span class="va">project</span>, <span class="st">'_migrateN.txt'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># migrate-n - new more compact heterozygosity format</span></span>
<span><span class="fu"><a href="../reference/vcf2migrate.html">vcf2migrate</a></span><span class="op">(</span><span class="va">vcf</span>, <span class="va">indiv_group</span>, <span class="va">groups</span>, out_file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">path</span>, <span class="va">project</span>, <span class="st">'_migrateH.txt'</span><span class="op">)</span>, method <span class="op">=</span> <span class="st">"H"</span><span class="op">)</span></span>
<span><span class="co"># arlequin </span></span>
<span><span class="fu"><a href="../reference/vcf2arlequin.html">vcf2arlequin</a></span><span class="op">(</span><span class="va">vcf</span>, <span class="va">indiv_group</span>, <span class="va">groups</span>, out_file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">path</span>, <span class="va">project</span>, <span class="st">'.arp'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># structure </span></span>
<span><span class="fu"><a href="../reference/vcf2structure.html">vcf2structure</a></span><span class="op">(</span><span class="va">vcf</span>, <span class="va">indiv_group</span>, <span class="va">groups</span>, out_file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">path</span>, <span class="va">project</span>, <span class="st">'.str'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># faststucture </span></span>
<span><span class="fu"><a href="../reference/vcf2structure.html">vcf2structure</a></span><span class="op">(</span><span class="va">vcf</span>, <span class="va">indiv_group</span>, <span class="va">groups</span>, out_file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">path</span>, <span class="va">project</span>, <span class="st">'.fstr'</span><span class="op">)</span>, method <span class="op">=</span> <span class="st">"F"</span><span class="op">)</span></span>
<span><span class="co"># genepop </span></span>
<span><span class="fu"><a href="../reference/vcf2genepop.html">vcf2genepop</a></span><span class="op">(</span><span class="va">vcf</span>, <span class="va">indiv_group</span>, <span class="va">groups</span>, out_file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">path</span>, <span class="va">project</span>, <span class="st">'.gen'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># smartsnp </span></span>
<span><span class="fu"><a href="../reference/vcf2smartsnp.html">vcf2smartsnp</a></span><span class="op">(</span><span class="va">vcf</span>, <span class="va">indiv_group</span>, <span class="va">groups</span>, out_file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">path</span>, <span class="va">project</span>, <span class="st">'.smartsnp'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># eigenstrat </span></span>
<span><span class="fu"><a href="../reference/vcf2eigenstrat.html">vcf2eigenstrat</a></span><span class="op">(</span><span class="va">vcf</span>, <span class="va">indiv_group</span>, <span class="va">groups</span>, out_file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">path</span>, <span class="va">project</span>, <span class="st">'_eigenstrat'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># bayescan </span></span>
<span><span class="fu"><a href="../reference/vcf2bayescan.html">vcf2bayescan</a></span><span class="op">(</span><span class="va">vcf</span>, <span class="va">indiv_group</span>, <span class="va">groups</span>, out_file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">path</span>, <span class="va">project</span>, <span class="st">'.bayescan'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># treemix </span></span>
<span><span class="fu"><a href="../reference/vcf2treemix.html">vcf2treemix</a></span><span class="op">(</span><span class="va">vcf</span>, <span class="va">indiv_group</span>, <span class="va">groups</span>, out_file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">path</span>, <span class="va">project</span>, <span class="st">'.treemix'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># apparent </span></span>
<span><span class="fu"><a href="../reference/vcf2apparent.html">vcf2apparent</a></span><span class="op">(</span><span class="va">vcf</span>, <span class="va">indiv_group</span>, <span class="va">groups</span>, out_file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">path</span>, <span class="va">project</span>, <span class="st">'.apparent'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># related </span></span>
<span><span class="fu"><a href="../reference/vcf2related.html">vcf2related</a></span><span class="op">(</span><span class="va">vcf</span>, <span class="va">indiv_group</span>, <span class="va">groups</span>, out_file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">path</span>, <span class="va">project</span>, <span class="st">'.related'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># dataframe with population membership in the last column</span></span>
<span><span class="fu"><a href="../reference/vcf2df.html">vcf2df</a></span><span class="op">(</span><span class="va">vcf</span>, <span class="va">indiv_group</span>, <span class="va">groups</span>, <span class="cn">TRUE</span>, out_file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">path</span>, <span class="va">project</span>, <span class="st">'.df'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># snapp </span></span>
<span><span class="fu"><a href="../reference/vcf2snapp.html">vcf2snapp</a></span><span class="op">(</span><span class="va">vcf</span>, <span class="va">indiv_group</span>, <span class="va">groups</span>, out_file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">path</span>, <span class="va">project</span>, <span class="st">'_snapp.nex'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># nexus - only SNPs, meant for SDVq analyses</span></span>
<span><span class="fu"><a href="../reference/vcf2nexus.html">vcf2nexus</a></span><span class="op">(</span><span class="va">vcf</span>, <span class="va">indiv_group</span>, <span class="va">groups</span>, out_file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">path</span>, <span class="va">project</span>, <span class="st">'_sdvq.nex'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># fasta </span></span>
<span><span class="fu"><a href="../reference/vcf2fasta.html">vcf2fasta</a></span><span class="op">(</span><span class="va">vcf</span>, <span class="va">indiv_group</span>, <span class="va">groups</span>, <span class="cn">TRUE</span>, out_file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">path</span>, <span class="va">project</span>, <span class="st">'.fas'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">##########</span></span>
<span><span class="co"># datasets for analyses with linked SNPs</span></span>
<span><span class="va">vcf</span> <span class="op">&lt;-</span> <span class="va">vcf_multiSNP</span></span>
<span></span>
<span><span class="co"># read all sample names in vcf</span></span>
<span><span class="va">vcf_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">vcf</span><span class="op">@</span><span class="va">gt</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">as_tibble</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">rename</span><span class="op">(</span>id <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span><span class="va">id</span>, id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># read sample to group assignment</span></span>
<span><span class="va">strata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">fpath</span>, <span class="st">"strata"</span><span class="op">)</span>, header <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">as_tibble</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span><span class="va">id</span>, id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># assign samples in vcf to groups</span></span>
<span><span class="va">strata</span> <span class="op">&lt;-</span> <span class="va">vcf_names</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">left_join</span><span class="op">(</span><span class="va">strata</span><span class="op">)</span></span>
<span><span class="co">#&gt; Joining with `by = join_by(id)`</span></span>
<span></span>
<span><span class="co"># check if all samples in vcf are assigned to groups</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">strata</span><span class="op">$</span><span class="va">pop</span><span class="op">)</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"vcf has individuals not assigned to a group"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">strata</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">strata</span><span class="op">$</span><span class="va">pop</span><span class="op">)</span> <span class="op">==</span> <span class="cn">TRUE</span>,<span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="va">indiv_group</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">strata</span><span class="op">$</span><span class="va">pop</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># read groups to be used; filter only those that are actually present</span></span>
<span><span class="va">groups</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">fpath</span>, <span class="st">"groups"</span><span class="op">)</span>, header <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">%&gt;%</span></span>
<span>  <span class="va">.</span><span class="op">[</span><span class="va">.</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">strata</span><span class="op">$</span><span class="va">pop</span><span class="op">)</span><span class="op">]</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co">##########</span></span>
<span><span class="co"># export data formats</span></span>
<span><span class="co"># fineRadStructure - expects VCF of linked SNPs</span></span>
<span><span class="fu"><a href="../reference/vcf2fineRadStructure.html">vcf2fineRadStructure</a></span><span class="op">(</span><span class="va">vcf</span>, <span class="va">indiv_group</span>, <span class="va">groups</span>, out_file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">path</span>, <span class="va">project</span>, <span class="st">'.finerad'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Tomas Hrbek.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
